generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum CredentialStatus {
  PENDING
  VERIFIED
  REVOKED
  EXPIRED
}

model Credential {
  id              String           @id @default(cuid())
  clerkUserId     String           @unique
  walletAddress   String
  status          CredentialStatus @default(VERIFIED)
  credentialId    String           @unique
  issuedAt        DateTime         @default(now())
  expiresAt       DateTime
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  transactionHash String?

  @@index([walletAddress])
}

model ActivityLog {
  id          String   @id @default(cuid())
  clerkUserId String
  type        String   // "login" | "wallet_created"
  createdAt   DateTime @default(now())

  @@index([clerkUserId])
  @@index([createdAt])
}

model CredentialProof {
  id             String   @id @default(cuid())
  credentialId   String   @unique
  walletAddress  String
  scheme         String   // "STUB" for now
  proof          Json
  publicSignals  Json
  createdAt      DateTime @default(now())

  @@index([walletAddress])
  @@index([credentialId])
}

// Tracks that user completed wallet onboarding. Used for redirect: has row → dashboard, no row → onboarding.
// Do NOT store private keys or encryptedPrivateKey here without explicit migration and guards.
model UserWalletSecret {
  id          String   @id @default(cuid())
  clerkUserId String   @unique
  createdAt   DateTime @default(now())

  @@index([clerkUserId])
}
